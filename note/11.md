# 程序重定位的困境



为了自动取指令和执行指令，处理器需要一个寄存器来自动跟踪每条指令，如图假定为IPR寄存器，IPR内容始终是下一条需要执行的指令，在程序执行之前，需要将第一条指令，存放到寄存器，如图，将0000存放到IPR中，程序开始执行时，处理器将IPR的内容放到地址线上，第一次发出的地址是0000，所以是去内存单元地址0000处去取第一条指令，并执行。

加入第一条指令执行完毕，自动更新IPR为下一条指令的地址，通过当前指令的地址+当前指令的长度算出来的，第一条指令的地址是0000，长度为3个字节，所以下条指令的地址为0003。



![image.png](https://cdn.nlark.com/yuque/0/2021/png/288075/1616491180469-3d0dfdd8-5584-4870-adca-864541abd892.png)

目前程序工作的很好，如果将程序指令和数据换一个地方，挪一挪，就不能工作了！出错了！



![image.png](https://cdn.nlark.com/yuque/0/2021/png/288075/1616491411830-bfec312e-dda0-48cd-bdd6-18742ae8df6a.png)

程序出错了，访问到了错误地址！



错误原因是，我们使用了绝对内存地址（物理地址），这样的程序无法在内存中自由浮动的，即无法重定位，使程序可以在内存自由浮动（可以重定位），是基本要求，哪里有空闲内存，就在哪里运行。