# 用TEST指令等待更新周期结束

进入中断处理内部，准备读当前时间数据。

在读取时间数据之前，先确认RTC是否处在更新周期，可以根据寄存器A的位7来判断。

如果这一位是0，意味着，更新周期还未开始，此时访问CMOS RAM里面额日期和时间是安全的。

如果这一位是1的话意味着正处于更新周期，或者更新周期马上就要启动。

![image-20210513165906923](C:\Users\81492\AppData\Roaming\Typora\typora-user-images\image-20210513165906923.png)

首先是用TEST指令等待更新周期结束。

**test指令**：

**可以用这条指令来测试某个寄存器或者内存里面的内容，是否带有某个特征。**

有两个操作数，宽度必须一致，比如都是8位。

在功能上与and基本上是相似的，将两个操作数按位进行逻辑与操作。

test运算之后结果是不保存的。

与and指令相同，test指令执行之后，溢出标志OF和进位标志CF都会等于0，0标志ZF和符号标志SF以及奇偶标志PF根据测试结果而定，对辅助进位标志AF的影响是未定义的。

假如想测试al中位3是0还是1，可以使用这条指令

test al,0x08

**当结果是0时ZF为1。**

**当结果不是0时ZF为0。**

因此我们用寄存器ZF是0还是1来判断寄存器al的位3是0还是1。

![image-20210513172920796](C:\Users\81492\AppData\Roaming\Typora\typora-user-images\image-20210513172920796.png)

## 更新周期示意图

![image-20210513173446692](C:\Users\81492\AppData\Roaming\Typora\typora-user-images\image-20210513173446692.png)

